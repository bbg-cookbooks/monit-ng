# Generated by Chef
set daemon <%= @poll_freq %>
  with start delay <%= @start_delay %>

set logfile <%= @log_file %>

set idfile <%= @id_file %>

set statefile <%= @state_file %>

set pidfile <%= @pid_file %>

<% @mail_servers.each do |mailserver| %>
set mailserver
  <%= mailserver.hostname %>
  <% if mailserver.key?('port') && mailserver.port %>
  port <%= mailserver.port %>
  <% end %>
  <% if mailserver.key?('username') && mailserver.username %>
  username '<%= mailserver.username %>'
  <% end %>
  <% if mailserver.key?('password') && mailserver.password %>
  password '<%= mailserver.password %>'
  <% end %>
  <% if mailserver.key?('security') && mailserver.security %>
  using <%= mailserver.security.upcase %>
  <% end %>
  <% if mailserver.key?('timeout') && mailserver.timeout %>
  with timeout <%= mailserver.timeout %>
  <% end %>

<% end %>
set mail-format {
      from: <%= @mail_from %>
   subject: <%= @mail_subject %>
   message: <%= @mail_msg %>
}

<% @alert.each do |alert| %>
set alert <%= alert.name %>
<% if alert.has_key?('only_on') -%>
  only on { <%= alert.only_on.join(', ') %> }
<% elsif alert.has_key?('subscriptions') -%>
  only on { <%= alert.subscriptions.join(', ') %> }
<% elsif alert.has_key?('but_not_on') -%>
  but not on { <%= alert.but_not_on.join(', ') %> }
<% end -%>

<% end %>
set eventqueue
  basedir <%= @eventqueue_dir %>
  slots <%= @eventqueue_slots %>

set httpd port <%= @port %> and
<% unless @listen.nil? -%>
  use address <%= @listen %>
<% end -%>
  <% @allow.each do |allowed| %>
  allow <%= allowed %>
  <% end %>

<% if @mmonit_url %>
set mmonit <%= @mmonit_url %>

<% end %>

<% @built_in_configs.each do |config| %>

  include <%= @built_in_config_path %>/<%= config %>

<% end %>

include <%= @conf_dir %>/*.conf
